angular.module("app").controller("AboutController",["$scope","layoutservice",function(n,t){t.SetSelectedPage("about")}]);angular.module("app").controller("AccountController",["$scope","accountservice","toastr",function(n,t,i){n.existingAccount={};n.newAccount={};n.recoverPass={};n.login=function(){t.Login(n.existingAccount).then(function(n){var i={ContactId:n.ContactId,FirstName:n.FirstName,LastName:n.LastName,Telephone:n.Telephone,Email:n.Email};t.SetUserData(i)},function(n){i.error(n,"Error")})};n.createAccount=function(){t.CreateAccount(n.newAccount).then(function(i){var r={ContactId:i.ContactId,FirstName:n.newAccount.FirstName,LastName:n.newAccount.LastName,Telephone:n.newAccount.Telephone,Email:n.newAccount.Email};t.SetUserData(r)},function(n){i.error(n,"Error")})};n.logout=function(){t.SetUserData({})};n.recoverPassword=function(){t.RecoverPassword(n.recoverPass).then(function(n){n.Message?i.success(n.Message):i.error("Error")},function(n){i.error(n,"Error")})}}]);angular.module("app").controller("ContactController",["$scope","layoutservice",function(n,t){t.SetSelectedPage("contact");n.lat=44.4268;n.lng=26.1025}]);angular.module("app").controller("HomeController",["$scope","alertservice","util","layoutservice","accountservice","toastr","FileUploader","$geolocation",function(n,t,i,r,u,f,e,o){function c(){for(var t=0;t<n.alertMarkers.length;t++)n.alertMarkers[t].setMap(null);n.alertMarkers=[];n.alertMarkers=_.map(n.alerts,function(t){return new google.maps.Marker({position:new google.maps.LatLng(t.Lat,t.Long),map:n.maps.mAlert})})}function p(t){n.marker==undefined?n.marker=new google.maps.Marker({position:t,map:n.maps.mNewAlert}):n.marker.setPosition(t)}function h(){n.newAlert={isPublic:!1,sendFeedback:!1,photo:{}};n.uploadPhotoStyle={"background-image":"url(img/camera-icon.png)"}}function l(){n.newAlert.street=undefined;n.newAlert.streetNo=undefined;n.newAlert.city=undefined}function a(t){n.newAlert.lat=t.A;n.newAlert.long=t.F;var i=new google.maps.Geocoder;i.geocode({latLng:t},function(t,i){var r,u;if(i==google.maps.GeocoderStatus.OK)if(t[0])for(r in t[0].address_components)t[0].address_components[r].types[0]=="route"&&(n.newAlert.street=t[0].address_components[r].long_name),t[0].address_components[r].types[0]=="street_number"&&(n.newAlert.streetNo=t[0].address_components[r].long_name),t[0].address_components[r].types[0]=="locality"&&(n.newAlert.city=t[0].address_components[r].long_name),t[0].address_components[r].types[0]=="sublocality_level_1"&&t[0].address_components[r].long_name.indexOf("Sector")!=-1&&(u=t[0].address_components[r].long_name,u.length>0&&(n.newAlert.city+=", "+u));else f.error("Nu s-a gasit niciun rezultat!","Error"),l();else f.error("Nu se poate determina locatia!","Error"),l();n.$apply()})}function s(){var r=t.GetRecentAlerts();r.then(function(t){t.forEach(function(n){n.Image=i.GetImage(n.Image);n.Color=n.StatusColor;n.Status=n.StatusName;var t=new Date(n.CreatedOn);n.DateDisplay=t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()});n.alerts=t;c();v()},function(n){f.error(n,"Error")})}function v(t){var i=n.alerts,r;t&&(i=_.filter(i,function(n){return n.Code.indexOf(t)>-1}));i.length>0?(r=_.sortBy(i,function(n){return new Date(n.ModifiedOn)}),n.alertDetail=_.last(r),n.hasAlertDetails=!0):n.hasAlertDetails=!1}function y(t){if(t){var i=_.find(n.categoriesHierarchy,function(n){return n.Id==t});n.subcategories=i.SubCategories;i.SubCategories[0]}}function w(){t.GetCategories().then(function(t){t&&t.length>0&&(n.categoriesHierarchy=t,n.categories=t,y(n.newAlert.categoryId))},function(n){f.error(n,"Error")})}n.alerts=[];n.alertDetail={};n.uploader=new e({url:t.AddAlertUrl});n.addAlertData={};n.categoriesHierarchy=[];n.categories=[];n.subcategories=[];n.hasAlertDetails=!1;n.codeSearch="";n.alertMarkers=[];r.SetSelectedPage("home");h();s();w();n.$on("userData.changed",function(){s()});n.$watch("codeSearch",function(){v(n.codeSearch)});n.$watch("newAlert.categoryId",function(n){y(n)});n.$on("mapInitialized",function(t,i){o.getCurrentPosition().then(function(t){n.newAlert.lat=n.newAlert.userLat=t.coords.latitude;n.newAlert.long=n.newAlert.userLong=t.coords.longitude;var r=new google.maps.LatLng(n.newAlert.lat,n.newAlert.long);n.marker=new google.maps.Marker({position:r,map:i});a(r);i.setCenter(r)});i.id=="mNewAlert"&&google.maps.event.addListener(i,"click",function(n){p(n.latLng);a(n.latLng)});i.id=="mAlert"&&c()});n.uploader.filters.push({name:"imageFilter",fn:function(n){var t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(t)!==-1}});n.uploader.onAfterAddingFile=function(t){n.uploader.queue.length>1&&n.uploader.removeFromQueue(0);n.newAlert.photo.name=t.file.name;n.newAlert.photo.size=t.file.size;n.newAlert.photo.type=t.file.type;var i=new FileReader;i.onload=function(t){n.uploadPhotoStyle={"background-image":"url("+t.target.result+")"};n.$apply()};i.readAsDataURL(t._file)};n.uploader.onBeforeUploadItem=function(t){t.formData.push(n.addAlertData)};n.uploader.onSuccessItem=function(n){n.Error?f.error(n.Error,"Error"):(s(),h(),f.success("Alerta a fost inregistrata cu succes","Succes"))};n.uploader.onErrorItem=function(n,t){angular.isObject(t.data)&&t.data.message||f.error("A aparut o eroare la inregistrarea alertei","Error");f.error(t.data.message,"Error")};n.addAlert=function(){var i;var r=n.newAlert.lat&&n.newAlert.long,u=r&&n.newAlert.userLat&&n.newAlert.userLong&&n.newAlert.description&&n.newAlert.subCategoryId,e=n.uploader.queue.length>0;u?(n.addAlertData={AddressLatitude:n.newAlert.lat,AddressLongitude:n.newAlert.long,CategoryId:n.newAlert.subCategoryId,Description:n.newAlert.description,PhotoName:n.newAlert.photo.name,IsPublic:n.newAlert.isPublic?1:0,SendFeedback:n.newAlert.sendFeedback?1:0,City:n.newAlert.city,StreetName:n.newAlert.street,StreetNo:n.newAlert.streetNo,UserLatitude:n.newAlert.userLat,UserLongitude:n.newAlert.userLong},e?n.uploader.uploadAll():t.AddAlertNoPhoto(n.addAlertData).then(function(){s();h();f.success("Alerta a fost inregistrata cu succes","Succes")},function(n){f.error(n,"Error")})):(i="Toate campurile sunt obligatorii. ",f.error(i,"Error"))};n.addressChanged=function(){}}]);angular.module("app").controller("LayoutController",["$rootScope","$scope","$location","layoutservice","accountservice",function(n,t,i,r,u){t.loginData=u.GetUserData();t.userLoggedIn=u.UserLoggedIn();t.selectedMenu=r.GetSelectedPage();t.$on("userData.changed",function(){t.loginData=u.GetUserData();t.userLoggedIn=u.UserLoggedIn()});t.$on("selectedPage.changed",function(){t.selectedMenu=r.GetSelectedPage()});t.fallbackLat=44.426977;t.fallbackLong=26.103564}]);
//# sourceMappingURL=controllers.min.js.map
